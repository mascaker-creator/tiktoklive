<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wafabot AI - Public View</title>
    
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --white: #ffffff;
            --black: #000000;
            --gray: #e0e0e0;
            --accent: #FF3D00; /* Warna aksen untuk elemen penting */
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Quicksand', sans-serif; 
        }

        body {
            background: transparent; /* Transparan agar bisa di-overlay di OBS */
            width: 100vw; height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 80px 40px;
        }

        /* --- NOTIFIKASI JOIN (FITUR 5) --- */
        #notification-area {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .join-notif {
            background: var(--white);
            border: 4px solid var(--black);
            box-shadow: 6px 6px 0px var(--black);
            padding: 12px 25px;
            font-size: 22px;
            font-weight: 700;
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* --- STATS HEADER --- */
        #header-stats {
            position: absolute; top: 60px; left: 40px; right: 40px;
            display: flex; justify-content: space-between;
            pointer-events: none;
        }

        .neo-badge {
            background: var(--white);
            color: var(--black);
            padding: 15px 30px;
            border: 4px solid var(--black);
            box-shadow: 8px 8px 0px var(--black);
            font-weight: 700; font-size: 24px;
            text-transform: uppercase;
        }

        /* --- TEKS AJAKAN (CTA) --- */
        #cta-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .cta-box {
            background: var(--white);
            border: 4px solid var(--black);
            box-shadow: 8px 8px 0px var(--black);
            padding: 25px 45px;
            font-size: 34px;
            font-weight: 700;
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: pulseCustom 2s infinite;
        }

        /* --- AI CARD --- */
        #ai-card-wrapper {
            width: 100%;
            display: none; /* Sembunyi jika tidak ada aktivitas */
        }

        .neo-card {
            background: var(--white);
            border: 6px solid var(--black);
            box-shadow: 20px 20px 0px var(--black);
            padding: 60px 50px;
            width: 100%;
            position: relative;
        }

        .user-pill {
            display: inline-block;
            background: var(--black);
            color: var(--white);
            padding: 8px 20px;
            font-size: 22px; font-weight: 700;
            margin-bottom: 30px;
            transform: rotate(-1deg);
        }

        .question-box {
            font-size: 30px; font-weight: 400; color: #555;
            line-height: 1.4; margin-bottom: 40px;
            padding-left: 20px; border-left: 6px solid var(--gray);
            font-style: italic;
        }

        .answer-box {
            font-size: 52px; font-weight: 700;
            line-height: 1.1; color: var(--black);
            min-height: 120px;
            letter-spacing: -1px;
        }

        /* --- TYPEWRITER CURSOR --- */
        .cursor {
            display: inline-block; width: 15px; height: 50px;
            background: var(--black); margin-left: 10px;
            animation: blink 0.8s infinite; vertical-align: middle;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes pulseCustom {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Audio Overlay */
        #audio-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: rgba(0,0,0,0); cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="audio-overlay" onclick="this.remove(); console.log('Audio Unlocked');"></div>

    <div id="header-stats" class="animate__animated animate__fadeInDown">
        <div class="neo-badge">WAFABOT AI</div>
        <div class="neo-badge">üë• <span id="view-count">0</span></div>
    </div>

    <div id="notification-area"></div>

    <div id="cta-wrapper" class="animate__animated">
        <div class="cta-box">
            Yuk komentar tanya ke Wafa AI üòä
        </div>
    </div>

    <div id="ai-card-wrapper" class="animate__animated">
        <div class="neo-card">
            <div class="user-pill" id="user-display"></div>
            <div class="question-box" id="quest-display"></div>
            <div class="answer-box" id="ans-display"></div>
            
            <div style="margin-top: 40px; font-weight: 700; border-top: 4px solid var(--black); padding-top: 20px; display: flex; justify-content: space-between; align-items: center;">
                <span>V2.5 / INDONESIA</span>
                <span style="color: var(--accent);">LIVE RESPONSE ‚óè</span>
            </div>
        </div>
    </div>

    <script>
        const socket = io(); // Otomatis konek ke server asal (Railway/Local)
        const wrapper = document.getElementById('ai-card-wrapper');
        const cta = document.getElementById('cta-wrapper');
        const notifArea = document.getElementById('notification-area');
        const userEl = document.getElementById('user-display');
        const questEl = document.getElementById('quest-display');
        const ansEl = document.getElementById('ans-display');

        let hideTimer;

        // --- FITUR 5: AUTO GREETING JOIN ---
        socket.on('userJoin', (data) => {
            const div = document.createElement('div');
            div.className = 'join-notif animate__animated animate__bounceInDown';
            div.innerHTML = `<span>üëã</span> ${data.msg}`;
            notifArea.appendChild(div);

            // Sembunyi setelah 3 detik
            setTimeout(() => {
                div.classList.replace('animate__bounceInDown', 'animate__fadeOutUp');
                setTimeout(() => div.remove(), 1000);
            }, 3000);
        });

        // --- RESPONS AI (DARI ANTREAN) ---
        socket.on('aiResponse', (data) => {
            // Bersihkan timer lama jika ada komen baru masuk
            clearTimeout(hideTimer);

            // Sembunyikan ajakan, tampilkan card
            cta.style.display = 'none';
            wrapper.style.display = 'block';
            wrapper.classList.remove('animate__fadeOutDown');
            wrapper.classList.add('animate__fadeInUp');

            userEl.innerText = `@${data.user.toUpperCase()}`;
            questEl.innerText = `"${data.question}"`;
            ansEl.innerHTML = "";

            // Jalankan Voice dan Mengetik
            playVoice(data.answer);
            startTypewriter(data.answer);
        });

        function startTypewriter(text) {
            let i = 0;
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            ansEl.appendChild(cursor);

            function type() {
                if (i < text.length) {
                    ansEl.innerHTML = text.substring(0, i + 1);
                    ansEl.appendChild(cursor);
                    i++;
                    setTimeout(type, 35); // Kecepatan mengetik
                } else {
                    // Hilangkan kursor setelah selesai
                    setTimeout(() => { if(cursor.parentNode) cursor.remove(); }, 1000);
                    
                    // Sembunyikan kotak setelah 15 detik SELESAI mengetik
                    hideTimer = setTimeout(() => {
                        wrapper.classList.replace('animate__fadeInUp', 'animate__fadeOutDown');
                        setTimeout(() => { 
                            wrapper.style.display = 'none';
                            cta.style.display = 'flex'; // Munculkan ajakan lagi
                            cta.classList.add('animate__fadeIn');
                        }, 1000);
                    }, 15000);
                }
            }
            type();
        }

        function playVoice(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // Stop suara lama
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        }

        // Update Viewer Count
        socket.on('viewerCount', (count) => {
            document.getElementById('view-count').innerText = count;
        });
    </script>
</body>
</html>
